name: deploy-helm
description: "Helm deploy"

inputs:
  bastion_user: 
    description: username@host for the ssh tunnel
    required: true
    type: string
  bastion_ssh_key: 
    description: private ssh key content
    required: true
    type: string

runs:
  using: "composite"
  steps:
    - run: |
        mkdir .ssh;
        BASTION_USER = ${{ inputs.bastion_user}}
        echo ${{ inputs.bastion_ssh_key }} | base64 -d > .ssh/github_bastion;
        chmod 600 .ssh/github_bastion;
        ssh-keyscan ${BASTION_USER#*@} > .ssh/known_hosts;
        ssh -i .ssh/github_bastion ${{ inputs.bastion_user }} 'echo 1';
      shell: bash
